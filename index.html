<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Galaxy Overlord: Ultra HD</title>
</head>
<body style="margin:0; background:#000510; overflow:hidden; font-family:'Segoe UI', sans-serif;">

<div style="position:absolute; top:10; left:10; color:#0ff; font-weight:bold; pointer-events:none; z-index:100; background:rgba(0,0,0,0.5); padding:10px; border-radius:10px; border:1px solid #0ff;">
    LEVEL: <span id="lvl">1</span> | COINS: <span id="scr">0</span><br>
    GEMS: <span id="gms">0</span> | BEST: <span id="best">0</span>
</div>

<canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let score = parseInt(localStorage.getItem('galaxyScore')) || 0;
    let level = parseInt(localStorage.getItem('galaxyLevel')) || 1;
    let gems = parseInt(localStorage.getItem('galaxyGems')) || 0;
    let bestScore = localStorage.getItem('galaxyBest') || 0;
    let active = true;

    document.getElementById('scr').innerText = score;
    document.getElementById('lvl').innerText = level;
    document.getElementById('gms').innerText = gems;
    document.getElementById('best').innerText = bestScore;

    let player = { x: canvas.width/2, y: canvas.height-100, hue: 180 };
    let bullets = [], enemyBullets = [], enemies = [], stars = [], particles = [];

    // Background Stars
    for(let i=0; i<100; i++) stars.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height, s: Math.random()*4+1});

    window.addEventListener('touchmove', e => {
        player.x = e.touches[0].clientX;
        player.y = e.touches[0].clientY - 50;
    });

    function createExplosion(x, y, color) {
        for(let i=0; i<10; i++) particles.push({x, y, vx:(Math.random()-0.5)*10, vy:(Math.random()-0.5)*10, life:20, color});
    }

    function spawnEnemy() {
        if(!active) return;
        let type = Math.random();
        let eType = "ship";
        if(level > 2 && type > 0.7) eType = "ufo";
        if(level > 4 && type > 0.9) eType = "bomber";

        enemies.push({ 
            x: Math.random()*(canvas.width-50)+25, 
            y: -50, 
            type: eType,
            hp: eType === "bomber" ? 3 : 1,
            speed: eType === "ufo" ? 4 : 2 + (level * 0.3),
            w: eType === "bomber" ? 60 : 40,
            angle: 0
        });
    }
    setInterval(spawnEnemy, 1200 / (1 + level*0.05));

    function drawPlayer(xPos, yPos) {
        ctx.save();
        ctx.shadowBlur = 20; ctx.shadowColor = `hsl(${player.hue}, 100%, 50%)`;
        ctx.fillStyle = `hsl(${player.hue}, 100%, 50%)`;
        // Ship Body (Advanced Design)
        ctx.beginPath();
        ctx.moveTo(xPos, yPos - 35);
        ctx.lineTo(xPos - 25, yPos + 15);
        ctx.lineTo(xPos, yPos + 5);
        ctx.lineTo(xPos + 25, yPos + 15);
        ctx.closePath();
        ctx.fill();
        // Thruster Fire
        ctx.fillStyle = "orange";
        ctx.fillRect(xPos - 5, yPos + 15, 10, 10 + Math.random()*10);
        ctx.restore();
    }

    function drawEnemy(en) {
        ctx.save();
        ctx.shadowBlur = 10; ctx.shadowColor = "red";
        if(en.type === "ufo") {
            ctx.fillStyle = "#ff00ff";
            ctx.beginPath(); ctx.ellipse(en.x, en.y, 25, 15, 0, 0, Math.PI*2); ctx.fill();
            ctx.fillStyle = "#0ff"; ctx.beginPath(); ctx.arc(en.x, en.y-5, 10, 0, Math.PI*2); ctx.fill();
        } else if(en.type === "bomber") {
            ctx.fillStyle = "#ff4400";
            ctx.fillRect(en.x-30, en.y-20, 60, 40);
            ctx.fillStyle = "red"; ctx.fillRect(en.x-10, en.y+10, 20, 10);
        } else {
            ctx.fillStyle = "#ff0000";
            ctx.beginPath(); ctx.moveTo(en.x, en.y+30); ctx.lineTo(en.x-20, en.y-10); ctx.lineTo(en.x+20, en.y-10); ctx.fill();
        }
        ctx.restore();
    }

    function gameLoop() {
        if(!active) return;
        ctx.fillStyle = 'rgba(0, 5, 16, 0.4)'; // Motion blur effect
        ctx.fillRect(0,0,canvas.width,canvas.height);

        stars.forEach(st => { st.y += st.s; if(st.y > canvas.height) st.y = 0; ctx.fillStyle = 'white'; ctx.fillRect(st.x, st.y, 2, 2); });

        drawPlayer(player.x, player.y);

        // Bullets
        if(Math.random() > 0.85) bullets.push({x: player.x, y: player.y - 30});
        bullets.forEach((b, i) => {
            b.y -= 15; ctx.fillStyle = '#ff0'; ctx.shadowBlur = 10; ctx.shadowColor = 'yellow';
            ctx.fillRect(b.x-2, b.y, 4, 15);
            if(b.y < 0) bullets.splice(i, 1);
        });

        // Particles
        particles.forEach((p, i) => {
            p.x += p.vx; p.y += p.vy; p.life--;
            ctx.fillStyle = p.color; ctx.fillRect(p.x, p.y, 3, 3);
            if(p.life <= 0) particles.splice(i, 1);
        });

        // Enemies
        enemies.forEach((en, i) => {
            if(en.type === "ufo") en.x += Math.sin(Date.now()/200)*5;
            en.y += en.speed;
            drawEnemy(en);

            if(Math.random() > 0.98) enemyBullets.push({x: en.x, y: en.y + 20});

            bullets.forEach((b, bi) => {
                if(Math.abs(b.x - en.x) < en.w/2 && Math.abs(b.y - en.y) < 25) {
                    en.hp--; bullets.splice(bi, 1);
                    if(en.hp <= 0) {
                        createExplosion(en.x, en.y, "orange");
                        enemies.splice(i, 1); score += 10;
                        if(Math.random() > 0.8) { gems++; localStorage.setItem('galaxyGems', gems); }
                        localStorage.setItem('galaxyScore', score);
                        if(score % 100 === 0) { level++; localStorage.setItem('galaxyLevel', level); }
                    }
                }
            });

            if(en.y > canvas.height || (Math.abs(en.x - player.x) < 40 && Math.abs(en.y - player.y) < 40)) gameOver();
        });

        enemyBullets.forEach((eb, i) => {
            eb.y += 8; ctx.fillStyle = '#f00'; ctx.fillRect(eb.x-2, eb.y, 5, 12);
            if(Math.abs(eb.x - player.x) < 25 && Math.abs(eb.y - player.y) < 25) gameOver();
            if(eb.y > canvas.height) enemyBullets.splice(i, 1);
        });

        document.getElementById('scr').innerText = score;
        document.getElementById('lvl').innerText = level;
        document.getElementById('gms').innerText = gems;
        requestAnimationFrame(gameLoop);
    }

    function gameOver() {
        active = false;
        if(score > bestScore) localStorage.setItem('galaxyBest', score);
        alert("GAME OVER! Saved progress.");
        location.reload();
    }

    gameLoop();
</script>
</body>
</html>

