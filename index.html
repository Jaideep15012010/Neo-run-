<!DOCTYPE html>
<html lang="en">
<head>
Â Â Â  <meta charset="UTF-8">
Â Â Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â Â Â  <title>JUNGLE MISSION 3D: MEGA PROJECT</title>
Â Â Â  <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&display=swap" rel="stylesheet">
Â Â Â  <style>
Â Â Â Â Â Â Â  body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Black Ops One', cursive; touch-action: none; color: white; }
Â Â Â Â Â Â Â  #loading-screen { position: absolute; inset: 0; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 500; }
Â Â Â Â Â Â Â  .spinner { width: 50px; height: 50px; border: 5px solid gold; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; }
Â Â Â Â Â Â Â  @keyframes spin { to { transform: rotate(360deg); } }
Â Â Â  </style>
</head>
<body>

<div id="loading-screen">
Â Â Â  <div class="spinner"></div>
Â Â Â  <p>INITIALIZING ENGINE...</p>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

<script>
/** * PART 1: GLOBAL VARIABLES & INITIALIZATION 
*/
let scene, camera, renderer, player, mixer, clock = new THREE.Clock();
let gameActive = false, score = 0, sessionGems = 0, speed = 1.0, currentLane = 0, vy = 0;
let tiles = [], obstacles = [], items = [], decorations = [];

// Local Storage Database
let db = JSON.parse(localStorage.getItem('mega_run_db')) || {
Â Â Â  best: 0, gems: 0, missionLevel: 1, 
Â Â Â  unlockedMaps: ['Jungle'], currentMap: 'Jungle'
};

function saveDB() { localStorage.setItem('mega_run_db', JSON.stringify(db)); }

// Scene Setup Function
function initBase() {
Â Â Â  scene = new THREE.Scene();
Â Â Â  scene.background = new THREE.Color(0x87CEEB); // Will change with Maps
Â Â Â  scene.fog = new THREE.Fog(0x87CEEB, 20, 150);

Â Â Â  camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.1, 1000);
Â Â Â  renderer = new THREE.WebGLRenderer({ antialias: true });
Â Â Â  renderer.setSize(window.innerWidth, window.innerHeight);
Â Â Â  renderer.setPixelRatio(window.devicePixelRatio);
Â Â Â  document.body.appendChild(renderer.domElement);

Â Â Â  const light = new THREE.AmbientLight(0xffffff, 1);
Â Â Â  const sun = new THREE.DirectionalLight(0xffffff, 0.8);
Â Â Â  sun.position.set(10, 50, 10);
Â Â Â  scene.add(light, sun);

Â Â Â  window.addEventListener('resize', () => {
Â Â Â Â Â Â Â  camera.aspect = window.innerWidth / window.innerHeight;
Â Â Â Â Â Â Â  camera.updateProjectionMatrix();
Â Â Â Â Â Â Â  renderer.setSize(window.innerWidth, window.innerHeight);
Â Â Â  });
}

initBase();
// --- END OF PART 1 ---
</script>
<div id="home-page" style="position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; background: rgba(0,0,0,0.85);">
Â Â Â  <h1 style="color:gold; font-size: 40px; margin-bottom: 10px;">PRO RUNNER v10</h1>
Â Â Â  <div style="background: #222; padding: 20px; border-radius: 15px; border: 2px solid gold; width: 70%; text-align: center; margin-bottom: 20px;">
Â Â Â Â Â Â Â  <p>ğŸ† BEST: <span id="best-score">0</span></p>
Â Â Â Â Â Â Â  <p>ğŸ’ GEMS: <span id="total-gems">0</span></p>
Â Â Â  </div>
Â Â Â  <button onclick="startGame()" style="background:gold; color:black; border:none; padding: 15px 50px; font-size: 20px; border-radius: 10px; cursor: pointer; font-weight: bold; margin: 5px;">START MISSION</button>
Â Â Â  <button onclick="showMissionPage()" style="background:#0ff; border:none; padding: 10px 40px; font-size: 16px; border-radius: 10px; cursor: pointer; margin: 5px;">MISSIONS</button>
</div>

<div id="mission-page" style="position: absolute; inset: 0; display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 110; background: #111;">
Â Â Â  <h1 style="color:#0f0;">MISSION LOG</h1>
Â Â Â  <div id="mission-list" style="width: 80%; margin-bottom: 20px;"></div>
Â Â Â  <button onclick="hideMissionPage()" style="background:white; color:black; padding: 10px 30px; border-radius: 5px;">BACK</button>
</div>

<div id="game-hud" style="position: absolute; top: 10px; width: 100%; display: none; justify-content: space-around; z-index: 50; font-size: 20px; color: gold;">
Â Â Â  <div>SCORE: <span id="current-score">0</span></div>
Â Â Â  <div style="color:#d000ff;">ğŸ’ <span id="current-gems">0</span></div>
</div>
// --- PART 3: UI NAVIGATION & DB LOGIC (Paste inside <script> after Part 1) ---

function updateHomeStats() {
Â Â Â  document.getElementById('best-score').innerText = db.best;
Â Â Â  document.getElementById('total-gems').innerText = db.gems;
}

function showMissionPage() {
Â Â Â  document.getElementById('home-page').style.display = 'none';
Â Â Â  document.getElementById('mission-page').style.display = 'flex';
Â Â Â  renderMissions();
}

function hideMissionPage() {
Â Â Â  document.getElementById('mission-page').style.display = 'none';
Â Â Â  document.getElementById('home-page').style.display = 'flex';
}

function startGame() {
Â Â Â  document.getElementById('home-page').style.display = 'none';
Â Â Â  document.getElementById('game-hud').style.display = 'flex';
Â Â Â  document.getElementById('loading-screen').style.display = 'none';
Â Â Â  gameActive = true;
Â Â Â  // Animation logic will be triggered here in later parts
}

// Initial Call to sync data
updateHomeStats();

// --- END OF PART 3 ---

// --- PART 4: WORLD BUILDER (Paste after Part 3 inside <script>) ---

const TILE_LIMIT = 15; // Kitne raste ke tukde ek sath dikhenge
const TILE_SIZE = 30;Â  // Ek tukde ki lambai

function createRoadTile(zPos) {
Â Â Â  // Road Material (Brownish Dirt)
Â Â Â  const roadGeo = new THREE.BoxGeometry(14, 0.8, TILE_SIZE);
Â Â Â  const roadMat = new THREE.MeshStandardMaterial({ color: 0x3d2b1f });
Â Â Â  const tile = new THREE.Mesh(roadGeo, roadMat);
Â Â Â  
Â Â Â  tile.position.set(0, 0, zPos); // Ekdum seedha rasta
Â Â Â  scene.add(tile);
Â Â Â  tiles.push(tile);

Â Â Â  // Raste ke side mein grass ya mitti
Â Â Â  const grassGeo = new THREE.PlaneGeometry(100, TILE_SIZE);
Â Â Â  const grassMat = new THREE.MeshStandardMaterial({ color: 0x228B22 });
Â Â Â  const leftGrass = new THREE.Mesh(grassGeo, grassMat);
Â Â Â  leftGrass.rotation.x = -Math.PI / 2;
Â Â Â  leftGrass.position.set(-57, -0.4, zPos);
Â Â Â  scene.add(leftGrass);
Â Â Â  
Â Â Â  const rightGrass = leftGrass.clone();
Â Â Â  rightGrass.position.x = 57;
Â Â Â  scene.add(rightGrass);
}

// Shuruat me rasta banana
function buildInitialMap() {
Â Â Â  for (let i = 0; i < TILE_LIMIT; i++) {
Â Â Â Â Â Â Â  createRoadTile(i * TILE_SIZE);
Â Â Â  }
}

buildInitialMap();

// --- END OF PART 4 ---

// --- PART 5: THE CHARACTER LOADER (Paste after Part 4 inside <script>) ---

const loader = new THREE.GLTFLoader();

function loadPlayer() {
Â Â Â  // Robot model ka link (Ye online server se load hota hai)
Â Â Â  const modelUrl = 'https://threejs.org/examples/models/gltf/RobotExpressive/RobotExpressive.glb';
Â Â Â  
Â Â Â  loader.load(modelUrl, (gltf) => {
Â Â Â Â Â Â Â  player = gltf.scene;
Â Â Â Â Â Â Â  player.scale.set(0.4, 0.4, 0.4); // Character ka size
Â Â Â Â Â Â Â  player.rotation.y = Math.PI;Â Â Â  // Character ka muh raaste ki taraf
Â Â Â Â Â Â Â  player.position.set(0, 0.5, 0); // Zameen ke thoda upar
Â Â Â Â Â Â Â  scene.add(player);

Â Â Â Â Â Â Â  // Animation setup: Robot bhagna shuru karega
Â Â Â Â Â Â Â  mixer = new THREE.AnimationMixer(player);
Â Â Â Â Â Â Â  const runAnim = gltf.animations.find(a => a.name === 'Running');
Â Â Â Â Â Â Â  if (runAnim) {
Â Â Â Â Â Â Â Â Â Â Â  mixer.clipAction(runAnim).play();
Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  
Â Â Â Â Â Â Â  // Loading screen ko hata dena jab model load ho jaye
Â Â Â Â Â Â Â  document.getElementById('loading-screen').style.display = 'none';
Â Â Â  }, 
Â Â Â  (xhr) => {
Â Â Â Â Â Â Â  // Kitna percent load hua (Optional console check)
Â Â Â Â Â Â Â  console.log((xhr.loaded / xhr.total * 100) + '% loaded');
Â Â Â  }, 
Â Â Â  (error) => {
Â Â Â Â Â Â Â  console.error('An error happened while loading the model', error);
Â Â Â  });
}

loadPlayer();

// --- END OF PART 5 ---

// --- PART 6: THE RENDER LOOP (Paste after Part 5 inside <script>) ---

function renderLoop() {
Â Â Â  requestAnimationFrame(renderLoop); // Ye screen ko har second 60 baar refresh karta hai

Â Â Â  const delta = clock.getDelta(); // Time ka hisab rakhne ke liye
Â Â Â  
Â Â Â  // Agar animation mixer load ho gaya hai, toh use update karo
Â Â Â  if (mixer) mixer.update(delta);

Â Â Â  // Camera ko player ke peeche set karna (Third Person View)
Â Â Â  if (player) {
Â Â Â Â Â Â Â  // Camera ko player ke thoda upar aur peeche rakha hai
Â Â Â Â Â Â Â  camera.position.set(player.position.x * 0.5, 7, player.position.z - 12);
Â Â Â Â Â Â Â  camera.lookAt(player.position.x, 2, player.position.z + 10);
Â Â Â  }

Â Â Â  // Saari cheezon ko screen par dikhana
Â Â Â  renderer.render(scene, camera);
}

// Loop ko chalu karna
renderLoop();

// --- END OF PART 6 ---

// --- PART 7: THE MOVEMENT LOGIC (Paste after Part 6 inside <script>) ---

function handleMovement() {
Â Â Â  if (!gameActive || !player) return;

Â Â Â  // 1. Robot ko aage badhana (Speed ke hisab se)
Â Â Â  player.position.z += speed;

Â Â Â  // 2. Score ko badhana (Duree ke hisab se)
Â Â Â  score += 1;
Â Â Â  document.getElementById('current-score').innerText = Math.floor(score);

Â Â Â  // 3. Raaste ko hamesha ke liye banana (Recycling)
Â Â Â  // Agar player pehle tile ko paar kar le, toh us tile ko utha kar aage rakh do
Â Â Â  if (player.position.z > tiles[0].position.z + TILE_SIZE) {
Â Â Â Â Â Â Â  let firstTile = tiles.shift(); // Pehla tile nikala
Â Â Â Â Â Â Â  firstTile.position.z += tiles.length * TILE_SIZE + TILE_SIZE; // Use sabse aage bheja
Â Â Â Â Â Â Â  tiles.push(firstTile); // List mein wapas joada
Â Â Â  }

Â Â Â  // 4. Speed ko dheere-dheere badhana (Difficulty)
Â Â Â  if (score % 500 === 0) {
Â Â Â Â Â Â Â  speed += 0.05;
Â Â Â  }
}

// Ab Render Loop (Part 6) mein is movement ko jodo
// Dhyaan do: Tumhe renderLoop function ke andar renderer.render se pehle handleMovement() likhna hoga
// Ya fir main agle parts mein iska updated loop de dunga. Filhaal ise niche paste kar do.

// --- END OF PART 7 ---

// --- PART 8: THE ANIMATION CONNECTOR (Paste after Part 7 inside <script>) ---

// Hum Part 6 wale renderLoop ko update kar rahe hain 
// taaki wo Movement aur Physics ko har frame mein chalaye.

function updateGame() {
Â Â Â  if (gameActive) {
Â Â Â Â Â Â Â  handleMovement(); // Jo Part 7 mein banaya tha
Â Â Â Â Â Â Â  
Â Â Â Â Â Â Â  // Agar aapne Part 9 (Controls) likh liya hota toh wo bhi yahan judta
Â Â Â Â Â Â Â  // Filhaal hum sirf movement aur camera ko sync kar rahe hain
Â Â Â  }
}

// Ye purane renderLoop ko replace karne ki zaroorat nahi hai, 
// bas uske andar ye line add karni hai. 
// Lekin asani ke liye main loop ko yahan sahi se rewrite kar raha hoon:

function finalLoop() {
Â Â Â  requestAnimationFrame(finalLoop);
Â Â Â  
Â Â Â  const delta = clock.getDelta();
Â Â Â  if (mixer) mixer.update(delta);

Â Â Â  if (gameActive) {
Â Â Â Â Â Â Â  updateGame(); 
Â Â Â  }

Â Â Â  if (player) {
Â Â Â Â Â Â Â  // Camera Follow Logic
Â Â Â Â Â Â Â  camera.position.lerp(new THREE.Vector3(player.position.x * 0.5, 7, player.position.z - 12), 0.1);
Â Â Â Â Â Â Â  camera.lookAt(player.position.x, 2, player.position.z + 10);
Â Â Â  }

Â Â Â  renderer.render(scene, camera);
}

// Purane renderLoop ko stop karke ise start karte hain
finalLoop();

// --- END OF PART 8 ---

// --- PART 9: THE INVERSE CONTROLS (Paste after Part 8 inside <script>) ---

let touchStartX = 0;
let touchStartY = 0;

const LANES = [-4, 0, 4]; // Teen lanes: Left, Middle, Right

function handleSwipe() {
Â Â Â  window.addEventListener('touchstart', (e) => {
Â Â Â Â Â Â Â  touchStartX = e.touches[0].clientX;
Â Â Â Â Â Â Â  touchStartY = e.touches[0].clientY;
Â Â Â  });

Â Â Â  window.addEventListener('touchend', (e) => {
Â Â Â Â Â Â Â  let touchEndX = e.changedTouches[0].clientX;
Â Â Â Â Â Â Â  let touchEndY = e.changedTouches[0].clientY;

Â Â Â Â Â Â Â  let diffX = touchEndX - touchStartX;
Â Â Â Â Â Â Â  let diffY = touchEndY - touchStartY;

Â Â Â Â Â Â Â  // Swipe ki pehchan (Horizontal vs Vertical)
Â Â Â Â Â Â Â  if (Math.abs(diffX) > Math.abs(diffY)) {
Â Â Â Â Â Â Â Â Â Â Â  // HORIZONTAL SWIPE (Left/Right)
Â Â Â Â Â Â Â Â Â Â Â  if (diffX > 40) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // RIGHT SWIPE -> Move LEFT (Inverse)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  currentLane = Math.max(-1, currentLane - 1);
Â Â Â Â Â Â Â Â Â Â Â  } else if (diffX < -40) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // LEFT SWIPE -> Move RIGHT (Inverse)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  currentLane = Math.min(1, currentLane + 1);
Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  } else {
Â Â Â Â Â Â Â Â Â Â Â  // VERTICAL SWIPE (Up/Down)
Â Â Â Â Â Â Â Â Â Â Â  if (diffY < -40) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // UP SWIPE -> JUMP
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (player.position.y <= 0.6) vy = 0.28;
Â Â Â Â Â Â Â Â Â Â Â  } else if (diffY > 40) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  // DOWN SWIPE -> SLIDE
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  player.scale.y = 0.2; 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  setTimeout(() => { player.scale.y = 0.4; }, 600);
Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  }
Â Â Â  });
}

// Lane change ko smooth banane ke liye player ki position update karna
function updatePlayerLane() {
Â Â Â  if (!player) return;
Â Â Â  
Â Â Â  // Target position lane ke hisab se
Â Â Â  let targetX = LANES[currentLane + 1];
Â Â Â  
Â Â Â  // Lerp se smooth movement (0.15 speed se slide karega)
Â Â Â  player.position.x += (targetX - player.position.x) * 0.15;

Â Â Â  // Gravity aur Jump ka hisab
Â Â Â  vy -= 0.015; // Gravity force
Â Â Â  player.position.y += vy;
Â Â Â  if (player.position.y < 0.5) {
Â Â Â Â Â Â Â  player.position.y = 0.5;
Â Â Â Â Â Â Â  vy = 0;
Â Â Â  }
}

// Controls chalu karein
handleSwipe();

// Ab humein updateGame function (Part 8) mein updatePlayerLane() ko call karna hoga.
// Wo main Part 10 mein sync kar dunga.

// --- END OF PART 9 ---

// --- PART 10: OBSTACLES & COLLISION (Paste after Part 9 inside <script>) ---

function spawnObstacle(zPos) {
    if (Math.random() > 0.6) { // 40% chance ki obstacle aaye
        const isHigh = Math.random() > 0.7; // 30% chance ki jump wala obstacle ho
        
        const obsGeo = isHigh ? new THREE.BoxGeometry(14, 1.5, 1) : new THREE.BoxGeometry(4, 2.5, 1);
        const obsMat = new THREE.MeshStandardMaterial({ color: isHigh ? 0xffff00 : 0xff0000 });
        const obstacle = new THREE.Mesh(obsGeo, obsMat);
        
        // Agar high hai toh beech mein, warna kisi ek lane mein
        const xPos = isHigh ? 0 : LANES[Math.floor(Math.random() * 3)];
        const yPos = isHigh ? 4.5 : 1;
        
        obstacle.position.set(xPos, yPos, zPos);
        scene.add(obstacle);
        obstacles.push(obstacle);
    }
}

// Part 7 ke handleMovement mein humne tile recycling ki thi, 
// ab wahan har naye tile par obstacle spawn karenge.
// (Main Part 11 mein saari physics ko ek saath updateGame function mein jodd dunga)

function checkCollisions() {
    if (!player || !gameActive) return;

    obstacles.forEach((obs, index) => {
        // Player aur Obstacle ke beech ki doori check karna
        const distance = player.position.distanceTo(obs.position);

        if (distance < 2.2) {
            // Agar slide kar rahe ho aur obstacle upar hai toh bach jaoge
            if (obs.position.y > 4 && player.scale.y < 0.3) {
                return; 
            }
            
            // Warna GAME OVER
            gameOver();
        }

        // Jo obstacles peeche chhut gaye unhe delete karna (Memory bachaane ke liye)
        if (obs.position.z < player.position.z - 20) {
            scene.remove(obs);
            obstacles.splice(index, 1);
        }
    });
}

function gameOver() {
    gameActive = false;
    alert("CRASHED! Final Score: " + Math.floor(score));
    
    // Best score save karna
    if (score > db.best) {
        db.best = Math.floor(score);
        saveDB();
    }
    
    location.reload(); // Game reset karne ke liye
}

// Part 8 ke updateGame function mein ab ye do cheezein jodni hai:
function updatePhysics() {
    updatePlayerLane(); // Lane change smooth karna (Part 9)
    checkCollisions();  // Takkar check karna (Part 10)
}

// --- END OF PART 10 ---

// --- PART 11: COINS & GEMS (Paste after Part 10 inside <script>) ---

function spawnItems(zPos) {
Â Â Â  // 50% chance ki coin ya gem dikhe
Â Â Â  if (Math.random() > 0.5) {
Â Â Â Â Â Â Â  const type = Math.random() > 0.85 ? 'gem' : 'coin'; // 15% chance Gem ka
Â Â Â Â Â Â Â  
Â Â Â Â Â Â Â  // Coin/Gem ki shakal (Geometry)
Â Â Â Â Â Â Â  const itemGeo = type === 'gem' ? new THREE.OctahedronGeometry(0.6) : new THREE.CylinderGeometry(0.5, 0.5, 0.1, 16);
Â Â Â Â Â Â Â  const itemMat = new THREE.MeshStandardMaterial({ 
Â Â Â Â Â Â Â Â Â Â Â  color: type === 'gem' ? 0xd000ff : 0xffff00,
Â Â Â Â Â Â Â Â Â Â Â  metalness: 0.8,
Â Â Â Â Â Â Â Â Â Â Â  roughness: 0.2
Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â  
Â Â Â Â Â Â Â  const item = new THREE.Mesh(itemGeo, itemMat);
Â Â Â Â Â Â Â  
Â Â Â Â Â Â Â  // Gem/Coin ko lanes mein set karna
Â Â Â Â Â Â Â  const xPos = LANES[Math.floor(Math.random() * 3)];
Â Â Â Â Â Â Â  item.position.set(xPos, 1.5, zPos);
Â Â Â Â Â Â Â  
Â Â Â Â Â Â Â  if (type === 'coin') item.rotation.x = Math.PI / 2;
Â Â Â Â Â Â Â  
Â Â Â Â Â Â Â  item.userData = { type: type }; // Pehchan ke liye
Â Â Â Â Â Â Â  scene.add(item);
Â Â Â Â Â Â Â  items.push(item);
Â Â Â  }
}

function checkItemCollections() {
Â Â Â  items.forEach((item, index) => {
Â Â Â Â Â Â Â  // Item ko gol ghumana (Animation)
Â Â Â Â Â Â Â  item.rotation.y += 0.05;

Â Â Â Â Â Â Â  // Player ne item uthaya ya nahi?
Â Â Â Â Â Â Â  if (player && player.position.distanceTo(item.position) < 2) {
Â Â Â Â Â Â Â Â Â Â Â  if (item.userData.type === 'coin') {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  db.coins = (db.coins || 0) + 1;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  score += 50; // Coin se score badhega
Â Â Â Â Â Â Â Â Â Â Â  } else {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  sessionGems += 1;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  db.gems += 1;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  score += 500; // Gem se score zyada badhega
Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  
Â Â Â Â Â Â Â Â Â Â Â  // HUD update karna
Â Â Â Â Â Â Â Â Â Â Â  document.getElementById('current-gems').innerText = sessionGems;
Â Â Â Â Â Â Â Â Â Â Â  
Â Â Â Â Â Â Â Â Â Â Â  // Item gayab karna
Â Â Â Â Â Â Â Â Â Â Â  scene.remove(item);
Â Â Â Â Â Â Â Â Â Â Â  items.splice(index, 1);
Â Â Â Â Â Â Â Â Â Â Â  saveDB();
Â Â Â Â Â Â Â  }

Â Â Â Â Â Â Â  // Peeche chhoote items ko delete karna
Â Â Â Â Â Â Â  if (item.position.z < player.position.z - 20) {
Â Â Â Â Â Â Â Â Â Â Â  scene.remove(item);
Â Â Â Â Â Â Â Â Â Â Â  items.splice(index, 1);
Â Â Â Â Â Â Â  }
Â Â Â  });
}

// Ab is function ko bhi updatePhysics (Part 10) mein jodh do
// updatePhysics ke andar checkItemCollections(); likhna hoga.

// --- END OF PART 11 ---

// --- PART 12: THE BRIDGE (Paste after Part 11 inside <script>) ---

// Ye function humne Part 3 mein khali chhoda tha, ab ise poora karte hain
function startGame() {
Â Â Â  // 1. UI chhupao aur Game HUD dikhao
Â Â Â  document.getElementById('home-page').style.display = 'none';
Â Â Â  document.getElementById('game-hud').style.display = 'flex';
Â Â Â  document.getElementById('loading-screen').style.display = 'none';
Â Â Â  
Â Â Â  // 2. Game ko active karo
Â Â Â  gameActive = true;
Â Â Â  
Â Â Â  // 3. Score aur Gems reset karo is session ke liye
Â Â Â  score = 0;
Â Â Â  sessionGems = 0;
Â Â Â  speed = 1.0;
Â Â Â  
Â Â Â  console.log("Mission Started!");
}

// Ek chota sa fix physics loop ke liye (Jo Part 11 mein reh gaya tha)
function updatePhysics() {
Â Â Â  if (!gameActive) return;
Â Â Â  updatePlayerLane();Â Â Â Â Â Â  // Part 9
Â Â Â  checkCollisions();Â Â Â Â Â Â Â  // Part 10
Â Â Â  checkItemCollections();Â Â  // Part 11
}

// --- END OF PART 12 ---

// --- PART 13: MAP SWITCHER (Paste after Part 12 inside <script>) ---

function updateEnvironment() {
    if (score > 2000 && db.unlockedMaps.includes('Desert')) {
        // Desert Theme
        scene.background = new THREE.Color(0xeedc82);
        scene.fog.color.set(0xeedc82);
    } else if (score > 4000) {
        // Cyber/Night Theme
        scene.background = new THREE.Color(0x000033);
        scene.fog.color.set(0x000033);
    }
}

// Ise handleMovement (Part 7) ke andar score badhne ke baad call karenge
// --- END OF PART 13 ---



    

