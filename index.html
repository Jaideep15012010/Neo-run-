<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JUNGLE MISSION 3D: FINAL</title>
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&display=swap" rel="stylesheet">
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Black Ops One', cursive; touch-action: none; color: white; }
        #loading-screen { position: absolute; inset: 0; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 500; }
        .spinner { width: 50px; height: 50px; border: 5px solid gold; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .screen { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; background: rgba(0,0,0,0.85); }
        .btn { background: gold; color: black; border: none; padding: 15px 50px; font-size: 20px; border-radius: 10px; cursor: pointer; font-weight: bold; margin: 10px; box-shadow: 0 5px #b8860b; }
        .btn:active { transform: translateY(3px); box-shadow: 0 2px #b8860b; }
        #game-hud { position: absolute; top: 10px; width: 100%; display: none; justify-content: space-around; z-index: 50; font-size: 22px; color: gold; text-shadow: 2px 2px #000; pointer-events: none; }
    </style>
</head>
<body>

<div id="loading-screen">
    <div class="spinner"></div>
    <p>BUILDING JUNGLE & MONSTERS...</p>
</div>

<div id="home-page" class="screen">
    <h1 style="color:gold; font-size: 45px; margin-bottom: 0;">JUNGLE RUNNER</h1>
    <p style="color: #0f0; margin-bottom: 20px;">3D MEGA PROJECT ACTIVE</p>
    <div style="background: #222; padding: 20px; border-radius: 15px; border: 2px solid gold; width: 70%; text-align: center; margin-bottom: 20px;">
        <p>üèÜ BEST: <span id="best-score">0</span></p>
        <p>üíé GEMS: <span id="total-gems">0</span></p>
    </div>
    <button class="btn" onclick="startGame()">START MISSION</button>
</div>

<div id="game-hud">
    <div>SCORE: <span id="current-score">0</span></div>
    <div style="color:#d000ff;">üíé <span id="current-gems">0</span></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

<script>
let scene, camera, renderer, player, mixer, clock = new THREE.Clock();
let gameActive = false, score = 0, sessionGems = 0, speed = 1.3, currentLane = 0;
let tiles = [], obstacles = [], items = [], decorations = [];
const LANES = [-4, 0, 4];
let isMagnetActive = false, magnetTimer = 0, monster;

let db = JSON.parse(localStorage.getItem('mega_run_db')) || { best: 0, gems: 0, missionLevel: 1 };
function saveDB() { localStorage.setItem('mega_run_db', JSON.stringify(db)); }

function init() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x050510);
    scene.fog = new THREE.FogExp2(0x050510, 0.015);

    camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.1, 1000);
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    scene.add(new THREE.AmbientLight(0xffffff, 0.7));
    const sun = new THREE.DirectionalLight(0xffffff, 1.2);
    sun.position.set(10, 50, 10);
    scene.add(sun);

    // Initial Spawning
    createMonster();
    for(let i=0; i<15; i++) spawnRoad(i*30);
    loadRobot();
    setupControls();
    
    document.getElementById('best-score').innerText = db.best;
    document.getElementById('total-gems').innerText = db.gems;
    animate();
}

function spawnRoad(zPos) {
    const tile = new THREE.Mesh(new THREE.BoxGeometry(14, 0.8, 31), new THREE.MeshStandardMaterial({ color: 0x2d1f14 }));
    tile.position.set(0, 0, zPos);
    scene.add(tile);
    tiles.push(tile);
    
    if(zPos > 60) {
        if(Math.random() > 0.6) spawnObstacle(zPos);
        if(Math.random() > 0.4) spawnItems(zPos);
        if(Math.random() > 0.8) spawnTrees(zPos);
    }
}

function spawnTrees(zPos) {
    const tree = new THREE.Group();
    const trunk = new THREE.Mesh(new THREE.CylinderGeometry(0.4, 0.6, 6), new THREE.
                                 
