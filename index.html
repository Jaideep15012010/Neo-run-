<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Galaxy Overlord: 3D Edition</title>
</head>
<body style="margin:0; background:#000814; overflow:hidden; font-family:'Orbitron', sans-serif;">

<div style="position:absolute; top:10; left:10; color:#0ff; font-weight:bold; pointer-events:none; z-index:100; text-shadow:0 0 10px #0ff;">
    LEVEL: <span id="lvl">1</span> | COINS: <span id="scr">0</span> | GEMS: <span id="gms">0</span>
</div>

<canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let score = parseInt(localStorage.getItem('galaxyScore')) || 0;
    let level = parseInt(localStorage.getItem('galaxyLevel')) || 1;
    let gems = parseInt(localStorage.getItem('galaxyGems')) || 0;
    let active = true, fireRate = 0;

    let player = { x: canvas.width/2, y: canvas.height-100, pwr: 0 };
    let bullets = [], enemyBullets = [], enemies = [], stars = [], powers = [];

    // Starfield Generation
    for(let i=0; i<120; i++) stars.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height, s: Math.random()*3+0.5, o: Math.random()});

    window.addEventListener('touchmove', e => {
        player.x = e.touches[0].clientX;
        player.y = e.touches[0].clientY - 50;
    });

    function spawnEnemy() {
        if(!active) return;
        let isElite = (level % 4 === 0);
        enemies.push({ 
            x: Math.random()*(canvas.width-60)+30, 
            y: -60, 
            type: isElite ? "elite" : "normal",
            hp: isElite ? 5 : 1,
            speed: isElite ? 1.5 : 2 + (level * 0.3),
            w: isElite ? 70 : 45,
            sinDir: Math.random() * Math.PI
        });
    }
    setInterval(spawnEnemy, 1300 / (1 + level*0.08));

    function draw3DShip(x, y, color, size, isPlayer) {
        ctx.save();
        ctx.shadowBlur = 15; ctx.shadowColor = color;
        
        // Main Body Gradient for 3D effect
        let grad = ctx.createLinearGradient(x-size, y, x+size, y);
        grad.addColorStop(0, '#333');
        grad.addColorStop(0.5, color);
        grad.addColorStop(1, '#333');
        
        ctx.fillStyle = grad;
        ctx.beginPath();
        if(isPlayer) {
            ctx.moveTo(x, y-size); ctx.lineTo(x-size, y+size); ctx.lineTo(x, y+size/2); ctx.lineTo(x+size, y+size);
        } else {
            ctx.moveTo(x, y+size); ctx.lineTo(x-size, y-size/2); ctx.lineTo(x, y-size); ctx.lineTo(x+size, y-size/2);
        }
        ctx.closePath(); ctx.fill();

        // Cockpit Glow
        ctx.fillStyle = "rgba(255,255,255,0.8)";
        ctx.beginPath();
        ctx.arc(x, isPlayer ? y : y-5, size/4, 0, Math.PI*2);
        ctx.fill();
        ctx.restore();
    }

    function gameLoop() {
        if(!active) return;
        ctx.fillStyle = 'rgba(0, 4, 12, 0.5)'; ctx.fillRect(0,0,canvas.width,canvas.height);

        stars.forEach(st => { 
            st.y += st.s; if(st.y > canvas.height) st.y = 0; 
            ctx.fillStyle = `rgba(255,255,255,${st.o})`; ctx.fillRect(st.x, st.y, 2, 2); 
        });

        draw3DShip(player.x, player.y, '#00e5ff', 30, true);

        // Auto Fire
        let rateLimit = player.pwr > 0 ? 5 : 12;
        if(fireRate++ % rateLimit === 0) bullets.push({x: player.x, y: player.y - 30});
        if(player.pwr > 0) player.pwr--;

        bullets.forEach((b, i) => {
            b.y -= 18; ctx.fillStyle = '#fff'; ctx.shadowBlur = 10; ctx.shadowColor = '#0ff';
            ctx.fillRect(b.x-2, b.y, 4, 18);
            if(b.y < 0) bullets.splice(i, 1);
        });

        // Power-ups
        powers.forEach((p, i) => {
            p.y += 3; ctx.fillStyle = '#f0f'; ctx.font = 'bold 20px Arial'; ctx.fillText('P', p.x, p.y);
            if(Math.abs(p.x - player.x) < 40 && Math.abs(p.y - player.y) < 40) { player.pwr = 300; powers.splice(i,1); }
        });

        // Enemies
        enemies.forEach((en, i) => {
            en.y += en.speed;
            if(en.type === "elite") en.x += Math.sin(en.sinDir += 0.05) * 4;
            draw3DShip(en.x, en.y, en.type === "elite" ? "#ff0055" : "#ff4400", en.w/2, false);

            // Crazy Shooting for Elites
            if(en.type === "elite" && Math.random() > 0.95) {
                enemyBullets.push({x: en.x, y: en.y, vx: Math.sin(Date.now())*3, vy: 5});
            } else if(Math.random() > 0.99) {
                enemyBullets.push({x: en.x, y: en.y, vx: 0, vy: 7});
            }

            bullets.forEach((b, bi) => {
                if(Math.abs(b.x - en.x) < en.w/2 && Math.abs(b.y - en.y) < 30) {
                    en.hp--; bullets.splice(bi, 1);
                    if(en.hp <= 0) {
                        if(en.type === "elite") powers.push({x: en.x, y: en.y});
                        enemies.splice(i, 1); score += 10;
                        if(score % 100 === 0) { level++; localStorage.setItem('galaxyLevel', level); }
                        localStorage.setItem('galaxyScore', score);
                    }
                }
            });

            if(en.y > canvas.height || (Math.abs(en.x - player.x) < 35 && Math.abs(en.y - player.y) < 35)) gameOver();
        });

        enemyBullets.forEach((eb, i) => {
            eb.y += eb.vy; eb.x += eb.vx;
            ctx.fillStyle = '#ff3300'; ctx.beginPath(); ctx.arc(eb.x, eb.y, 4, 0, Math.PI*2); ctx.fill();
            if(Math.abs(eb.x - player.x) < 25 && Math.abs(eb.y - player.y) < 25) gameOver();
            if(eb.y > canvas.height) enemyBullets.splice(i, 1);
        });

        document.getElementById('scr').innerText = score;
        document.getElementById('lvl').innerText = level;
        document.getElementById('gms').innerText = gems;
        requestAnimationFrame(gameLoop);
    }

    function gameOver() {
        active = false; alert("MISSION FAILED! Score: " + score); location.reload();
    }

    gameLoop();
</script>
</body>
</html>


